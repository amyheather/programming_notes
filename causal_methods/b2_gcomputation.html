

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G-computation &#8212; Amy Notes  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'causal_methods/b2_gcomputation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="G-estimation of structural nested models" href="b3_gestimation.html" />
    <link rel="prev" title="Marginal structural models (MSM)" href="b1_marginal_structural_models.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Programming notes</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../books/making_books.html">
                        Books
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../python/general.html">
                        Python
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../r/general.html">
                        R
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../programming_notes/git.html">
                        Git
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../simulation/simulation.html">
                        Simulation
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../causal_concepts/1_predict_vs_causal.html">
                        Causality
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../programming_notes/latex.html">
                        Other
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/amyheather/programming_notes/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../books/making_books.html">
                        Books
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../python/general.html">
                        Python
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../r/general.html">
                        R
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../programming_notes/git.html">
                        Git
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../simulation/simulation.html">
                        Simulation
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../causal_concepts/1_predict_vs_causal.html">
                        Causality
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../programming_notes/latex.html">
                        Other
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/amyheather/programming_notes/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction and causal concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/1_predict_vs_causal.html">Prediction v.s. causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/2_intro_to_causality.html">The three “languages” of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/3_dags.html">Directed acyclic graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/4_assumptions.html">Assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/5_estimands.html">Causal estimands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/6_propensity_scores.html">Propensity scores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/7_target_trial.html">Target trial emulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="summary.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="a1_multivariable_regression.html">Multivariable regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="a2_stratification.html">Stratification</a></li>
<li class="toctree-l1"><a class="reference internal" href="a3_matching.html">Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="a4_iptw.html">Inverse probability of treatment weighting (IPTW) with baseline covariates</a></li>
<li class="toctree-l1"><a class="reference internal" href="b1_marginal_structural_models.html">Marginal structural models (MSM)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">G-computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="b3_gestimation.html">G-estimation of structural nested models</a></li>
<li class="toctree-l1"><a class="reference internal" href="c1_instrumental_variable.html">Instrumental variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="c2_regression_discontinuity.html">Regression discontinuity (RD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="c3_interrupted_time.html">Interrupted time series (ITS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="c4_diff_in_diff.html">Difference in differences (DiD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="other.html">Other methods</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../causal_concepts/1_predict_vs_causal.html" class="nav-link">Prediction v.s. causal inference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">G-computation</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="section" id="g-computation">
<h1>G-computation<a class="headerlink" href="#g-computation" title="Permalink to this heading">#</a></h1>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading">#</a></h2>
<p>Names for this method:</p>
<ul class="simple">
<li><p><strong>G-computation</strong></p></li>
<li><p><strong>Parametric G-formula</strong></p></li>
<li><p><strong>G-standardisation</strong></p></li>
<li><p><strong>Standardisation</strong> <a class="reference external" href="https://doi.org/10.1093/aje/kwq474">[Vansteelandt and Keiding 2011]</a></p></li>
<li><p><strong>Outcome regression</strong> <a class="reference external" href="http://www.statslab.cam.ac.uk/~qz280/talk/ssrmp-2020/slides.pdf">[source]</a></p></li>
</ul>
<p>There has been some debate around terminology. As quoted from <a class="reference external" href="https://doi.org/10.1093/aje/kwq474">Vansteelandt and Keiding 2011</a>:</p>
<blockquote>
<div><p><em>‘The term standardization is revealing and rather well-known to epidemiologists and therefore, in our opinion, is the terminology of choice. The term G-computation has so far been mostly reserved to refer to standardization of the effects of time-varying exposures; potentially the term “G-standardization” as nomenclature for “standardization with respect to generalized exposure regimens” would have been more enlightening. Despite the essential equivalence of G-computation for point exposures and standardization with the total population as the reference, we believe that the developments from the causal inference literature add to the literature on standardization. They give a precise meaning to standardized effect measures in terms of counterfactuals, provide insight into the delicate differences between conditional and marginal epidemiologic effect measures, and suggest novel standardization techniques that combine precision with robustness against model misspecification and extrapolation.’</em></p>
</div></blockquote>
</div>
<div class="section" id="about-the-method">
<h2>About the method<a class="headerlink" href="#about-the-method" title="Permalink to this heading">#</a></h2>
<p>G-computation involves using a statistical model (e.g. predict) to predict <strong>potential</strong> outcomes (counterfactuals - with and without exposure).<a class="reference external" href="https://doi.org/10.1136/jech-2022-219267">[Igelström et al. 2022]</a></p>
<div class="mermaid">
              flowchart LR;

    X(&quot;Binary treatment (X)&quot;):::white;
    Y(&quot;Outcome (Y)&quot;):::white;
    W(&quot;Confounder (W)&quot;):::white;

    X --&gt; Y;
    W --&gt; X;
    W --&gt; Y;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Key steps:</p>
<ol class="arabic simple">
<li><p><strong>Fit model on observed data</strong> - regression model with Y as outcome and X and W as predictors (perhaps also with polynomials and/or interactions if there are multiple control variables)</p></li>
<li><p>Make identical copy of observed data, but just <strong>replace</strong> outcome so all X=1.</p></li>
<li><p>Create another where all to X=0.</p></li>
<li><p>Use our fitted model to <strong>predict outcomes</strong> in the two counterfactual datasets <a class="reference external" href="https://marginaleffects.com/vignettes/gcomputation.html">[source]</a> <a class="reference external" href="https://causallycurious.com/posts/standardization/standardization">[Batten 2023]</a> <a class="reference external" href="http://www.statslab.cam.ac.uk/~qz280/talk/ssrmp-2020/slides.pdf">[source]</a></p></li>
<li><p>Estimate the <strong>Average treatment effect (ATE)</strong> - this is the mean difference (+ 95% CI) in the predicted outcomes between the two groups.<a class="reference external" href="https://causallycurious.com/posts/standardization/standardization">[Batten 2023]</a>  It essentially describes the average effect, at a population level, of moving an entire population from untreated to treated.<a class="reference external" href="https://doi.org/10.1038/s41598-020-65917-x">[Chatton et al. 2020]</a></p></li>
</ol>
<p>For <strong>average treatment effect on the treated (ATT)</strong>:</p>
<ul class="simple">
<li><p>This is the average effect of treatment on those subjects who ultimately received the treatement <a class="reference external" href="https://doi.org/10.1038/s41598-020-65917-x">[Chatton et al. 2020]</a></p></li>
<li><p>To calculate ATT, use <strong>only the treated units in steps 2 and 3</strong>. ‘The control units are still used to fit the model in 1, but only the treated units are used to compute the predicted values.’ <a class="reference external" href="https://stats.stackexchange.com/questions/613569/estimating-and-interpreting-the-att-with-regression-adjustment-and-marginal-effe">[source]</a></p></li>
</ul>
<p>You could also compute <strong>average treatment effect on the untreated (ATU).</strong> <a class="reference external" href="https://doi.org/10.1186/s12874-016-0282-4">[Wang et al. 2017]</a></p>
<p>To get standard errors, you can use bootstrapping or the delta method. <a class="reference external" href="https://stats.stackexchange.com/questions/613569/estimating-and-interpreting-the-att-with-regression-adjustment-and-marginal-effe">[source]</a></p>
</div>
<div class="section" id="how-does-this-method-enable-us-to-deal-with-treatment-dependent-confounding">
<h2>How does this method enable us to deal with treatment-dependent confounding?<a class="headerlink" href="#how-does-this-method-enable-us-to-deal-with-treatment-dependent-confounding" title="Permalink to this heading">#</a></h2>
<p>See the example of treatment-dependent confounding below.</p>
<div class="mermaid">
              flowchart LR;

    ak(&quot;A&lt;sub&gt;K&lt;/sub&gt;: Treatment&quot;):::green;
    ak1(&quot;A&lt;sub&gt;K+1&lt;/sub&gt;: Treatment&quot;):::green;
    yk1(&quot;Y&lt;sub&gt;K+1&lt;/sub&gt;: Outcome&quot;):::green;
    yk2(&quot;Y&lt;sub&gt;K+2&lt;/sub&gt;: Outcome&quot;):::green;
    lk(&quot;L&lt;sub&gt;K&lt;/sub&gt;: Confounder&quot;):::white;
    lk1(&quot;L&lt;sub&gt;K+1&lt;/sub&gt;: Confounder&quot;):::white;
    u(&quot;U: Unmeasured&lt;br&gt;confounder&quot;):::white;

    ak --&gt; yk1;
    u --&gt; yk1;
    u --&gt; lk;
    lk --&gt; ak;
    lk --&gt; ak1;
    ak --&gt; ak1;
    ak --&gt; lk1;
    u --&gt; lk1;
    lk1 --&gt; ak1;
    ak1 --&gt; yk2;
    u --&gt; yk2;
    lk --&gt; yk1;
    lk --&gt; lk1;
    lk1 --&gt; yk2;
    yk1 --&gt; yk2;

    classDef white fill:#FFFFFF, stroke:#FFFFFF
    classDef black fill:#FFFFFF, stroke:#000000
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>If we regressed A<sub>K</sub> and A<sub>K+1</sub> on Y<sub>K+2</sub> while adjusting for confounders should we adjust for the time-varying L<sub>K+1</sub> and Y<sub>K+1</sub>? We can see that:</p>
<ol class="arabic simple">
<li><p><strong>L<sub>K+1</sub> is a collider</strong> on the non-causal path A<sub>K</sub> –&gt; L<sub>K+1</sub> &lt;– U –&gt; Y<sub>K+2</sub></p></li>
</ol>
<div class="mermaid">
              flowchart LR;

    ak(&quot;A&lt;sub&gt;K&lt;/sub&gt;: Treatment&quot;):::red;
    ak1(&quot;A&lt;sub&gt;K+1&lt;/sub&gt;: Treatment&quot;):::white;
    yk1(&quot;Y&lt;sub&gt;K+1&lt;/sub&gt;: Outcome&quot;):::white;
    yk2(&quot;Y&lt;sub&gt;K+2&lt;/sub&gt;: Outcome&quot;):::red;
    lk(&quot;L&lt;sub&gt;K&lt;/sub&gt;: Confounder&quot;):::white;
    lk1(&quot;L&lt;sub&gt;K+1&lt;/sub&gt;: Confounder&quot;):::red;
    u(&quot;U: Unmeasured&lt;br&gt;confounder&quot;):::red;

    ak --&gt; yk1;
    u --&gt; yk1;
    u --&gt; lk;
    lk --&gt; ak;
    lk --&gt; ak1;
    ak --&gt; ak1;
    ak --&gt; lk1;
    u --&gt; lk1;
    lk1 --&gt; ak1;
    ak1 --&gt; yk2;
    u --&gt; yk2;
    lk --&gt; yk1;
    lk --&gt; lk1;
    lk1 --&gt; yk2;
    yk1 --&gt; yk2;

    classDef white fill:#FFFFFF, stroke:#FFFFFF
    classDef black fill:#FFFFFF, stroke:#000000
    classDef red fill:#FFCCCB, stroke:red
    classDef green fill:#DDF2D1, stroke: #FFFFFF
    linkStyle 6,7,10 stroke:red;
        </div><ol class="arabic simple" start="2">
<li><p><strong>L<sub>K+1</sub> is a mediator</strong> on the causal path A<sub>K</sub> –&gt; L<sub>K+1</sub> –&gt; A<sub>K+1</sub> –&gt; Y<sub>K+2</sub></p></li>
</ol>
<div class="mermaid">
              flowchart LR;

    ak(&quot;A&lt;sub&gt;K&lt;/sub&gt;: Treatment&quot;):::red;
    ak1(&quot;A&lt;sub&gt;K+1&lt;/sub&gt;: Treatment&quot;):::red;
    yk1(&quot;Y&lt;sub&gt;K+1&lt;/sub&gt;: Outcome&quot;):::white;
    yk2(&quot;Y&lt;sub&gt;K+2&lt;/sub&gt;: Outcome&quot;):::red;
    lk(&quot;L&lt;sub&gt;K&lt;/sub&gt;: Confounder&quot;):::white;
    lk1(&quot;L&lt;sub&gt;K+1&lt;/sub&gt;: Confounder&quot;):::red;
    u(&quot;U: Unmeasured&lt;br&gt;confounder&quot;):::white;

    ak --&gt; yk1;
    u --&gt; yk1;
    u --&gt; lk;
    lk --&gt; ak;
    lk --&gt; ak1;
    ak --&gt; ak1;
    ak --&gt; lk1;
    u --&gt; lk1;
    lk1 --&gt; ak1;
    ak1 --&gt; yk2;
    u --&gt; yk2;
    lk --&gt; yk1;
    lk --&gt; lk1;
    lk1 --&gt; yk2;
    yk1 --&gt; yk2;

    classDef white fill:#FFFFFF, stroke:#FFFFFF
    classDef black fill:#FFFFFF, stroke:#000000
    classDef red fill:#FFCCCB, stroke:red
    classDef green fill:#DDF2D1, stroke: #FFFFFF
    linkStyle 6,8,9 stroke:red;
        </div><ol class="arabic simple" start="3">
<li><p><strong>L<sub>K+1</sub> is a confounder</strong> on the non-causal path A<sub>K+1</sub> &lt;– L<sub>K+1</sub> –&gt; Y<sub>K+2</sub></p></li>
</ol>
<div class="mermaid">
              flowchart LR;

    ak(&quot;A&lt;sub&gt;K&lt;/sub&gt;: Treatment&quot;):::white;
    ak1(&quot;A&lt;sub&gt;K+1&lt;/sub&gt;: Treatment&quot;):::red;
    yk1(&quot;Y&lt;sub&gt;K+1&lt;/sub&gt;: Outcome&quot;):::white;
    yk2(&quot;Y&lt;sub&gt;K+2&lt;/sub&gt;: Outcome&quot;):::red;
    lk(&quot;L&lt;sub&gt;K&lt;/sub&gt;: Confounder&quot;):::white;
    lk1(&quot;L&lt;sub&gt;K+1&lt;/sub&gt;: Confounder&quot;):::red;
    u(&quot;U: Unmeasured&lt;br&gt;confounder&quot;):::white;

    ak --&gt; yk1;
    u --&gt; yk1;
    u --&gt; lk;
    lk --&gt; ak;
    lk --&gt; ak1;
    ak --&gt; ak1;
    ak --&gt; lk1;
    u --&gt; lk1;
    lk1 --&gt; ak1;
    ak1 --&gt; yk2;
    u --&gt; yk2;
    lk --&gt; yk1;
    lk --&gt; lk1;
    lk1 --&gt; yk2;
    yk1 --&gt; yk2;

    classDef white fill:#FFFFFF, stroke:#FFFFFF
    classDef black fill:#FFFFFF, stroke:#000000
    classDef red fill:#FFCCCB, stroke:red
    classDef green fill:#DDF2D1, stroke: #FFFFFF
    linkStyle 8,9,13 stroke:red;
        </div><p>If we adjusted for for L<sub>K+1</sub> we would therefore:</p>
<ul class="simple">
<li><p>Eliminate confounding bias</p></li>
<li><p>Introduce collider (stratification) bias</p></li>
<li><p>Introduce over-adjustment bias in the effect of A<sub>K</sub> (from controlling for mediator)</p></li>
</ul>
<p>The same argument applies when adjusting for the intermediate outcome Y<sub>K+1</sub>. In other words, its <strong>impossible</strong> as we need to simultaneously adjust for and not adjust for L<sub>K+1</sub> and Y<sub>K+1</sub>.
‘The <strong>g-formula</strong> resolves this problem by decoupling adjusting, and not adjusting, for treatment-dependent confounders’ like L<sub>K+1</sub>.</p>
<ol class="arabic simple">
<li><p><strong>G-formula step 1</strong> involves fitting a model with outcome, treatment and confounders. This adjusts for L<sub>K+1</sub> and Y<sub>K+1</sub>, to <strong>avoid confounding bias</strong>.</p></li>
<li><p><strong>G-formula step 2</strong> involves predicting outcomes where all patients are set to no treatment, or all to treatment, and comparing the outcomes to get the average treatment effect. This marginalises/averages over the counterfactual distribution of L<sub>K+1</sub> and Y<sub>K+1</sub>, so they are <strong>not adjusted for</strong>, to avoid collider and over-adjustment biases</p></li>
</ol>
<p>Hence, it simultaneously does and not adjust for L<sub>K+1</sub> and Y<sub>K+1</sub>. <a class="reference external" href="https://doi.org/10.31234/osf.io/m37uc">[Loh et al. 2023]</a></p>
</div>
<div class="section" id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Sequential ignorability assumption i.e. <strong>no unmeasured confounding</strong> - ‘when there is no causal effect, the treatment and outcome are conditionally independent given a set of pre-treatment covariates’ <a class="reference external" href="https://doi.org/10.31234/osf.io/m37uc">[Loh et al. 2023]</a></p></li>
</ul>
</div>
<div class="section" id="g-computation-v-s-iptw">
<h2>G-computation v.s. IPTW<a class="headerlink" href="#g-computation-v-s-iptw" title="Permalink to this heading">#</a></h2>
<p>‘Standardization models the outcome, whereas inverse probability weighting models the treatment’.  If we were to do IPW and standardisation ‘<strong>without using any models</strong> (i.e. non-parametrically) then we would expect both methods to give the exact same result’. <a class="reference external" href="https://causallycurious.com/posts/standardization/standardization">[Batten 2023]</a></p>
<p>However, we expect them to differ if we use <strong>models</strong> to estimate them since some degree of misspecification is inescapable in models, ‘but misspecification in the treatment model (IP weighting) and outcome model (standardisation) will not generally result in the same magnitude and direction of bias in the effect estimate’.</p>
<p>‘Both IP weighting and standardization are estimators of the <strong>g-formula</strong>, a general method for causal inference first described in 1986… We say that standardization is a <strong>plug-in g-formula</strong> estimator because it simply replaces the conditional mean outcome in the g-formula by its estimates. When those estimates come from parametric models, we refer to the method as the <strong>parametric g-formula</strong>. Because here we were only interested in the average causal effect, we estimated parametrically the conditional mean outcome.’</p>
<p>‘Often there is no need to choose between IP weighting and the parametric g-formula. When both methods can be used to estimate a causal effect, <strong>just use both methods</strong>. Also, whenever possible, use <strong>doubly robust methods</strong> that combine models for treatment and for outcome in the same estimator’. <a class="reference external" href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">[Hernán and Robins 2024]</a></p>
</div>
</div>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="b1_marginal_structural_models.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Marginal structural models (MSM)</p>
      </div>
    </a>
    <a class="right-next"
       href="b3_gestimation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">G-estimation of structural nested models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#terminology">Terminology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-the-method">About the method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-does-this-method-enable-us-to-deal-with-treatment-dependent-confounding">How does this method enable us to deal with treatment-dependent confounding?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#g-computation-v-s-iptw">G-computation v.s. IPTW</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/causal_methods/b2_gcomputation.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Amy Heather.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>