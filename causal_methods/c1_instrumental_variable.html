

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instrumental variables &#8212; Amy Notes  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'causal_methods/c1_instrumental_variable';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Regression discontinuity (RD)" href="c2_regression_discontinuity.html" />
    <link rel="prev" title="G-estimation of structural nested models" href="b3_gestimation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Programming notes</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../books/making_books.html">
                        Books
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../python/general.html">
                        Python
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../r/general.html">
                        R
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../programming_notes/git.html">
                        Git
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../simulation/simulation.html">
                        Simulation
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../causal_concepts/1_predict_vs_causal.html">
                        Causality
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../programming_notes/latex.html">
                        Other
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/amyheather/programming_notes/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../books/making_books.html">
                        Books
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../python/general.html">
                        Python
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../r/general.html">
                        R
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../programming_notes/git.html">
                        Git
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../simulation/simulation.html">
                        Simulation
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../causal_concepts/1_predict_vs_causal.html">
                        Causality
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../programming_notes/latex.html">
                        Other
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/amyheather/programming_notes/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction and causal concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/1_predict_vs_causal.html">Prediction v.s. causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/2_intro_to_causality.html">The three “languages” of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/3_dags.html">Directed acyclic graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/4_assumptions.html">Assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/5_estimands.html">Causal estimands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/6_propensity_scores.html">Propensity scores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../causal_concepts/7_target_trial.html">Target trial emulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="summary.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="a1_multivariable_regression.html">Multivariable regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="a2_stratification.html">Stratification</a></li>
<li class="toctree-l1"><a class="reference internal" href="a3_matching.html">Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="a4_iptw.html">Inverse probability of treatment weighting (IPTW) with baseline covariates</a></li>
<li class="toctree-l1"><a class="reference internal" href="b1_marginal_structural_models.html">Marginal structural models (MSM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="b2_gcomputation.html">G-computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="b3_gestimation.html">G-estimation of structural nested models</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Instrumental variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="c2_regression_discontinuity.html">Regression discontinuity (RD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="c3_interrupted_time.html">Interrupted time series (ITS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="c4_diff_in_diff.html">Difference in differences (DiD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="other.html">Other methods</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../causal_concepts/1_predict_vs_causal.html" class="nav-link">Prediction v.s. causal inference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Instrumental...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="section" id="instrumental-variables">
<h1>Instrumental variables<a class="headerlink" href="#instrumental-variables" title="Permalink to this heading">#</a></h1>
<div class="section" id="what-is-an-instrumental-variable">
<h2>What is an instrumental variable?<a class="headerlink" href="#what-is-an-instrumental-variable" title="Permalink to this heading">#</a></h2>
<p>An <strong>instrumental variable (IV)</strong> is a variable that satisfies the following assumptions:</p>
<ol class="arabic simple">
<li><p>It <strong>causes variation in the exposure/treatment</strong> (i.e. relevance assumption - it is correlated with X, an endogenous explanatory variable) - also known as the <em>strong first stage</em> assumption</p></li>
<li><p>It is <strong>unrelated to the outcome</strong> (and so any affect on outcome is exclusively via the instruments effect on the exposure) - also known as the <em>exclusion restriction</em></p></li>
<li><p>As it is unrelated to the outcome, is is therefore <strong>unrelated to unmeasured confounders</strong> (unmeasured differences in characteristics that affect outcomes) (i.e. <strong>exogeneity</strong> assumption - it is an exogneous variable) <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a><a class="reference external" href="https://doi.org/10.1136/jech-2022-219267">[Igelström et al. 2022]</a> <a class="reference external" href="https://towardsdatascience.com/instrumental-variables-a-practical-explanation-1a583408a5b9">[source]</a> <a class="reference external" href="https://medium.com/teconomics-blog/machine-learning-meets-instrumental-variables-c8eecf5cec95">[source]</a></p></li>
</ol>
<p>This is illustrated below:</p>
<div class="mermaid">
              flowchart LR;

    iv(&quot;Instrumental variable&quot;):::white;
    e(&quot;Exposure/treatment&quot;):::white;
    o(&quot;Outcome&quot;):::white;
    u(&quot;Unmeasured confounders&quot;):::white;

    iv --&gt; e;
    e --&gt; o;
    u -.-&gt; e;
    u -.-&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Due to these characteristics, instrumental variables enable us to mimic randomisation to treatment. <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a> In fact, <strong>randomisation to treatment</strong> in an RCT is an example instrumental variable (it meets the above assumptions).</p>
<div class="mermaid">
              flowchart LR;

    iv(&quot;RCT randomisation to treatment&quot;):::white;
    e(&quot;Exposure/treatment&quot;):::white;
    o(&quot;Outcome&quot;):::white;
    u(&quot;Unmeasured confounders&quot;):::white;

    iv --&gt; e;
    e --&gt; o;
    u -.-&gt; e;
    u -.-&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>You have likely identified an instrumental variable ‘if people are confused when you tell them about the instrument’s relationship to the outcome’.</p>
<ul class="simple">
<li><p>No-one is confused if you say family size will reduce labour supply of women</p></li>
<li><p>They will be confused if you use gender composition of first two children as instrumental variable, and find ‘that mothers whose first two children were the same gender were employed outside the home less than those whose two children had a balanced sex ratio’, as they don’t expect gender composition to incentive work outside home - but it is related as if both the same gender, they’re more likely to try again for child of another gender <a class="reference external" href="https://mixtape.scunning.com/06-regression_discontinuity">[Causal Inference: The Mixtape - Scott Cunningham]</a></p></li>
</ul>
</div>
<div class="section" id="two-stage-least-squares-2sls">
<h2>Two-stage least squares (2SLS)<a class="headerlink" href="#two-stage-least-squares-2sls" title="Permalink to this heading">#</a></h2>
<p>You can use the two-stage least squares (2SLS) method to estimate the causal effect, using instrumental variables for individual-level data.</p>
<ol class="arabic simple">
<li><p><strong>Regress exposure (${x}$) on instrumental variable (G) to produce $\hat{x}$ (estimate of exposure independent of confounders)</strong></p></li>
<li><p><strong>Regress outcome (Y) on $\hat{x}$</strong>. Here, $\hat{x}$ is replacing the actual value of the problematic predictor, ${x}$. [BSc Medical Sciences]</p></li>
</ol>
<p>We include the measured confounders in both stages.</p>
<ul class="simple">
<li><p>Included in first stage to reflect exogenous movement in treatment</p></li>
<li><p>Included in second stage to avoid omitted variable bias</p></li>
</ul>
<p>The ‘groups being compared differ only in likelihoods of treatment, as opposed to a division into pure treatment and control groups’. Hence, this ‘method estimates an incremental or “marginal” effect of treatment only over the range of variation in treatment across the IV groups’. <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a></p>
<p>‘IV analysis estimates a local average treatment effect (LATE) among ‘compliers’ - individudals whose exposure status is affected by the instrument. This group cannot be precisely identified, and the LATE may therefore sometimes be of limited practical or policy relevance’. <a class="reference external" href="https://doi.org/10.1136/jech-2022-219267">[Igelström et al. 2022]</a></p>
<p>There is a variant called ‘<strong>Three-Stage Least Squares (3SLS)</strong>. This method is an extension of the 2SLS method and is used when there are more than two endogenous variables in the model. The 3SLS method is based on the idea that the endogenous variables are correlated with each other, and therefore, the coefficients of these variables need to be estimated simultaneously.’ <a class="reference external" href="https://fastercapital.com/content/Econometric-Techniques--Understanding-Tinbergen-s-Statistical-Innovations.html">[source]</a></p>
</div>
<div class="section" id="assumptions-of-instrumental-variable-analysis">
<h2>Assumptions of instrumental variable analysis<a class="headerlink" href="#assumptions-of-instrumental-variable-analysis" title="Permalink to this heading">#</a></h2>
<p>(1) <strong>Instrumental variable assumptions</strong>(as above)</p>
<p>(2) <strong>Homogeneity assumption</strong> - the association between the instrumental variable and the exposure is homogenous (same for everyone in the population), or the effect of the exposure on the outcome is homogenous [BSc Medical Sciences]</p>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading">#</a></h2>
<p>‘A concern with any IV strategy is that the instrumental variable is correlated with unobserved determinants of the outcome of interest.’ Can address by estimating models for held-back risk factors pre-determined at delivery date, looking for correlation with the IV. <a class="reference external" href="http://www.nber.org/papers/w24493">[Card et al. 2018]</a></p>
<p>A <strong>weak instrument</strong> will produce an estimate that is biased and imprecise (and we may then have false confidence in it being unbiased). To help address this…</p>
<ul class="simple">
<li><p>Check strong first stage assumption - i.e. want statistically significant relationship when regress X on Z - suggests F-statistic of at least 11 in first stage.</p></li>
<li><p>Can’t test exclusion restriction assumption - just have to think through any possible ways that the IV could affect the outcome that aren’t via the treatment. <a class="reference external" href="https://medium.com/teconomics-blog/machine-learning-meets-instrumental-variables-c8eecf5cec95">[source]</a></p></li>
</ul>
</div>
<div class="section" id="non-parametric-instrumental-variable-methods">
<h2>Non-parametric instrumental variable methods<a class="headerlink" href="#non-parametric-instrumental-variable-methods" title="Permalink to this heading">#</a></h2>
<p>‘<strong>Most IV applications make use of a two-stage least squares</strong> procedure [2SLS; e.g., Angrist et al., 1996] that requires assumptions of linearity and homogeneity (e.g., all airline customers must have the same price sensitivity). <strong>Nonparametric IV methods from the econometrics</strong> literature relax these assumptions [e.g., Newey and Powell, 2003]. However, these methods work by modeling the outcome as an unknown linear combination of a pre-specified set of basis functions of the treatment and other covariates (e.g. Hermite polynomials, wavelets or splines) and then modeling the conditional expectation of each of these basis functions in terms of the instruments (i.e. the number of equations is quadratic in the number of basis functions). This <strong>requires a strong prior understanding of the data generating process</strong> by the researcher, and the <strong>complexity of both specification and estimation</strong> explodes when there are more than a handful of inputs.’ <a class="reference external" href="http://proceedings.mlr.press/v70/hartford17a.html">[Hartford et al. 2017]</a></p>
<p><a class="reference external" href="http://proceedings.mlr.press/v70/hartford17a.html">Hartford et al. 2017</a> propose the Deep IV framework, which uses ML to perform IV analysis…</p>
<ul class="simple">
<li><p>First stage: fit conditional distribution for treatment given instruments and covariates with a deep neural net (stochastic gradient descent (SGD)) <a class="reference external" href="http://proceedings.mlr.press/v70/hartford17a.html">[Hartford et al. 2017]</a></p></li>
<li><p>Second stage: ‘target a loss function involving integration over the conditional treatment distribution from the first stage’ <a class="reference external" href="http://proceedings.mlr.press/v70/hartford17a.html">[Hartford et al. 2017]</a>… ‘incorporate the fitted conditional distribution to minimize a loss function using a second deep neural net, and use an out-of-sample causal validation procedure to tune the deep network hyper-parameters’ <a class="reference external" href="https://medium.com/teconomics-blog/machine-learning-meets-instrumental-variables-c8eecf5cec95">[source]</a></p></li>
</ul>
<p>They provide the <a class="reference external" href="https://github.com/jhartford/DeepIV">package on GitHub</a> for this analysis using Python (broken - only supports Keras 2.0.6) (although there has been non-integrated pull request to make it work with Keras 2.3.1).</p>
<p><a class="reference external" href="https://openreview.net/forum?id=sy4Kg_ZQmS7">Xu et al. 2021</a> provide another example of IV with deep learning, again <a class="reference external" href="https://github.com/liyuan9988/DeepFeatureIV">sharing code on GitHub</a>. This has open peer review, and so helpfully has some insightful comments around assumptions and theoretical justifications.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h2>
<div class="section" id="example-1-mendelian-randomisation">
<h3>Example 1: Mendelian randomisation<a class="headerlink" href="#example-1-mendelian-randomisation" title="Permalink to this heading">#</a></h3>
<p>Disease association with non-genetic risk factors are often confounded - for example:</p>
<div class="mermaid">
              flowchart LR;

    e(&quot;Drinking alcohol&quot;):::green;
    o(&quot;Lung cancer&quot;):::green;
    c(&quot;Smoking&quot;):::white;

    e --&gt; o;
    c --&gt; e; c --&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Genotype-phenotype associations are much less likely to be confounded. They are aetiological associations (causing or contributing to disease/condition development).</p>
<p>If we know of a gene closely linked to the phenotype without direct effect on the disease, it can often be reasonably assumed that the gene is not itself associated with any confounding factors - a phenomenon called <strong>Mendelian randomization</strong>. Genetic variants (G) should influence the exposure (X) but should not be directly associated with confounders (U) or the outcome (Y).</p>
<p>We can then identify the causal relationship between X and Y - if it doesn’t cause Y, then G should be independent of Y. This is the same logic as we use for an RCT (where G would be randomisation to treatment).</p>
<div class="mermaid">
              flowchart TD;

    con:::outline;
    subgraph con[&quot;If X doesn't cause Y...&quot;]
      G:::white;
      X:::white;
      Y:::white;
      U:::white;
    end

    G --&gt; X;
    U --&gt; X;
    U --&gt; Y;

    uncon:::outline;
    subgraph uncon[&quot;If X causes Y...&quot;]
      G2(&quot;G&quot;):::white;
      X2(&quot;X&quot;):::white;
      Y2(&quot;Y&quot;):::white;
      U2(&quot;U&quot;):::white;
    end

    G2 --&gt; X2;
    U2 --&gt; X2;
    U2 --&gt; Y2;
    X2 --&gt; Y2;

    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef outline fill:#FFFFFF;
        </div><p>[BSc Medical Sciences]</p>
</div>
<div class="section" id="example-2-effect-of-intensive-treatment-on-mortality-in-patients-with-acute-myocardial-infarction">
<h3>Example 2: Effect of intensive treatment on mortality in patients with acute myocardial infarction<a class="headerlink" href="#example-2-effect-of-intensive-treatment-on-mortality-in-patients-with-acute-myocardial-infarction" title="Permalink to this heading">#</a></h3>
<p>Example from <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">McClellan et al. 1994</a>: Want to determine the effect of more intensive treatments (e.g. catheterisation and revascualisation) on mortality in elderly patients with acute myocardial infarction. They use distance from hospital as an ‘instrumental variable to account for unobserved case-mix variation (selection bias) in observational Medicare claims data’ <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a></p>
<p>Why is distance an instrumental variable?</p>
<ul class="simple">
<li><p>Intensive treatment only performed at certain hospitals</p></li>
<li><p>Comparing treatments and outcomes between patients treated at different hospitals risks selection bias, ‘because physician and patient decisions that influence treatment choice may ALSO influence choice of hospital to go to - e.g. AMI patients who appear to be better candidates for catheterisation may be disproportionately admitted to catheterisation hospitals’ <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a></p></li>
<li><p>Distance from hospital (specifically, differential distance to hospital providing intensive treatment):</p>
<ul>
<li><p><strong>Affects</strong> probability of receiving intensive treatment</p></li>
<li><p><strong>Does not affect</strong> patient characteristics</p></li>
</ul>
</li>
<li><p>Hence, distance from hospital can be used as an instrumental variable <a class="reference external" href="https://doi.org/10.1136/jech-2022-219267">[Igelström et al. 2022]</a> - it meets the IV assumptions:</p>
<ol class="arabic simple">
<li><p>Causes variation in whether receive intensive treatment</p></li>
<li><p>Unrelated to mortality</p></li>
<li><p>Unrelated to unmeasured confounders (like the physician and patient decisions)</p></li>
</ol>
</li>
</ul>
<div class="mermaid">
              flowchart LR;

    treat(&quot;&lt;b&gt;Intensive treatment&lt;/b&gt;&lt;br&gt;(e.g. catheterisation)&quot;):::green;
    mortality(&quot;&lt;b&gt;Mortality&lt;/b&gt;&quot;):::green;
    hosp(&quot;&lt;b&gt;Hospital&lt;/b&gt; attended&lt;br&gt;(i.e. whether it&lt;br&gt;offers the treatment)&quot;):::white;
    dist(&quot;&lt;b&gt;Differential distance&lt;/b&gt; to&lt;br&gt; hospital providing&lt;br&gt;intenstive treatment&quot;):::white;
    decisions(&quot;Physician and patient&lt;br&gt;&lt;b&gt;decisions&lt;/b&gt;&quot;):::white;

    dist --&gt; hosp;
    decisions --&gt; hosp;
    hosp --&gt; treat;
    treat --&gt; mortality;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>First, checked for presence of selection bias (i.e. whether hospital type affects treatment intensity - and therefore whether simple comparisons of treatments and outcomes across hospital types are valid). Then, as was present, used IV methods to estimate effect of intensive treatment on mortality. <strong>Differential distance approximately randomises patients to different likelihoods of receiving intensive treatments</strong>, uncorrelated with health status.</p>
<ul class="simple">
<li><p>First, compared two groups of apx. equal size - patients near to catheterisation hospital (differential distance &lt;= 2.5 miles) and patients far from them (&gt; 2.5 miles). This evidenced assumption that distribution of health status in AMI patients is independent of differential distance, and illustrates IV method, estimating the ‘average effect of invasive treatment for all patients who are marginal from the standpoint of the near-far IVs - those who undergo catheterisation in the relatively near group and not in the relatively far group - if the two groups are balanced and if catheterisation is the only treatment that differs between the groups’</p></li>
<li><p>Then used more general IV estimation netchniques with wide range of differential distance groups, and account for small remaining observable differences between differential-distance groups <a class="reference external" href="https://doi.org/10.1001/jama.1994.03520110039026">[McClellan et al. 1994]</a></p></li>
</ul>
</div>
<div class="section" id="example-3-caesarean-section">
<h3>Example 3: caesarean section<a class="headerlink" href="#example-3-caesarean-section" title="Permalink to this heading">#</a></h3>
<p>This example is taken from It’s about time: Cesarean sections and neonatal health <a class="reference external" href="https://linkinghub.elsevier.com/retrieve/pii/S0167629617307609">[Costa-Ramón et al. 2018]</a>.</p>
<p>The study aimed to estimate the causal relationship between caesarean section and newborn health: Apgar-1 and Apgar-5; Reanimation (assisted ventilation); ICU admission; Neonatal death; Umbilical cord pH.</p>
<p>Several known measured confounders (e.g. age, gestational length, obstetric risk), but also omitted variable bias due to other unmeausred confounders.</p>
<div class="mermaid">
              flowchart LR;

    e(&quot;Caesarean section&quot;):::green;
    o(&quot;Neonatal health&lt;br&gt;(e.g. Apgar)&quot;):::green;
    c(&quot;Measured and&lt;br&gt;unmeasured confounders&quot;):::white;

    e --&gt; o;
    c --&gt; e; c --&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Time of birth can be used as an instrumental variable as:</p>
<ul class="simple">
<li><p>It is associated with treatment (unplanned C-sections more likely in early hours of night)</p></li>
<li><p>It is unrelated to outcome and confounders (mothers giving birth at different times of day are observationally similar - suggesting excess number of C-sections observed are due to non-medical reasons)</p></li>
</ul>
<div class="mermaid">
              flowchart LR;

    e(&quot;Caesarean section&quot;):::green;
    o(&quot;Neonatal health&lt;br&gt;(e.g. Apgar)&quot;):::green;
    c(&quot;Measured and&lt;br&gt;unmeasured confounders&quot;):::white;
    i(&quot;Time of day&quot;):::white;

    i --&gt; e;
    e --&gt; o;
    c --&gt; e; c --&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Showing example of results for Apgar-5 scores.</p>
<p>From <strong>standard OLS estimation</strong>, unplanned CS coefficient for predicting Apgar-5 (with standard error in parentheses, clustered at hospital-shift level):</p>
<ul class="simple">
<li><p>-0.219 (0.038) (regression controlling only for weekday and hospital fixed effects)</p></li>
<li><p>-0.219 (0.037) (maternal controls added)</p></li>
<li><p>-0.142 (0.043) (pregnancy controls added)</p></li>
</ul>
<p><strong>Interpretation</strong>: Delivering C-section associated with decline in Apgar-5. However, likely biased as C-section v.s. vaginal birth cohorts not comparable.</p>
<p>Hence, performed 2SLS. In <strong>first stage</strong>, early night coefficients for predicting unplanned C-section were:</p>
<ul class="simple">
<li><p>0.073 (0.011)</p></li>
<li><p>0.073 (0.011)</p></li>
<li><p>0.063 (0.011)</p></li>
</ul>
<p><strong>Intepretation</strong>: Births in early night are 6% more likely to be by caesarean.</p>
<p>In <strong>second stage</strong>, unplanned CS coefficients for predicting Apgar-5:</p>
<ul class="simple">
<li><p>-0.965 (0.404)</p></li>
<li><p>-0.987 (0.408)</p></li>
<li><p>-0.936 (0.464)</p></li>
</ul>
<p><strong>Interpretation</strong>: Increased probability of Apgar-5, significant at 5% significance level.</p>
</div>
</div>
<div class="section" id="python-example">
<h2>Python example<a class="headerlink" href="#python-example" title="Permalink to this heading">#</a></h2>
<p>This example is taken from <a class="reference external" href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html">Causal Inference for the Brave and True</a> (MIT license).</p>
<p>Interested in causal effect of education on wage. Confounders like ability (which affect education and wage).</p>
<div class="mermaid">
              flowchart LR;

    e(&quot;Education&lt;br&gt;(years of schooling)&quot;):::green;
    o(&quot;Wage&quot;):::green;
    c(&quot;Year of birth&lt;br&gt;State of birth&lt;br&gt;Ability&quot;):::white;

    e --&gt; o;
    c --&gt; e; c --&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><p>Quarter of birth (i.e. dividing year into Q1, Q2, Q3, Q4) impacts education (kids born earlier in school year start education at older age than kids born later in school year), and does not impact wage (other than through its impact on education).</p>
<div class="mermaid">
              flowchart LR;

    e(&quot;Education&lt;br&gt;(years of schooling)&quot;):::green;
    o(&quot;Wage&quot;):::green;
    c(&quot;Year of birth&lt;br&gt;State of birth&lt;br&gt;Ability&quot;):::white;
    i(&quot;Quarter of birth&quot;):::white;

    i --&gt; e;
    e --&gt; o;
    c --&gt; e; c --&gt; o;
  
    classDef white fill:#FFFFFF, stroke:#FFFFFF;
    classDef black fill:#FFFFFF, stroke:#000000;
    classDef empty width:0px,height:0px;
    classDef green fill:#DDF2D1, stroke: #FFFFFF;
        </div><div class="section" id="set-up-import-packages-and-data">
<h3>Set-up (import packages and data)<a class="headerlink" href="#set-up-import-packages-and-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">linearmodels.iv</span> <span class="kn">import</span> <span class="n">IV2SLS</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># Define file paths</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Paths</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Singleton object for storing paths to data and database.&#39;&#39;&#39;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;../data&#39;</span>
    <span class="n">ak91</span> <span class="o">=</span> <span class="s1">&#39;ak91.csv&#39;</span>


<span class="n">paths</span> <span class="o">=</span> <span class="n">Paths</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">ak91</span><span class="p">))</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>log_wage</th>
      <th>years_of_schooling</th>
      <th>year_of_birth</th>
      <th>quarter_of_birth</th>
      <th>state_of_birth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.790019</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.952494</td>
      <td>11.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.315949</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.595926</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.068915</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>37.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert quarter of birth from categorcal to dummy variable</span>
<span class="n">factor_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;q</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;quarter_of_birth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
       <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quarter_of_birth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()})</span>

<span class="n">factor_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>log_wage</th>
      <th>years_of_schooling</th>
      <th>year_of_birth</th>
      <th>quarter_of_birth</th>
      <th>state_of_birth</th>
      <th>q1</th>
      <th>q2</th>
      <th>q3</th>
      <th>q4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.790019</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.952494</td>
      <td>11.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.315949</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.595926</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>45.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.068915</td>
      <td>12.0</td>
      <td>30.0</td>
      <td>1.0</td>
      <td>37.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="traditional-ols-estimate">
<h3>Traditional OLS estimate<a class="headerlink" href="#traditional-ols-estimate" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="s2">&quot;years_of_schooling&quot;</span><span class="p">):</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">exog</span><span class="p">]</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">std_errors</span><span class="p">[</span><span class="n">exog</span><span class="p">]</span>
    <span class="n">p_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="n">exog</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter: </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE: </span><span class="si">{</span><span class="n">se</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95 CI: </span><span class="si">{</span><span class="p">(</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">se</span><span class="p">,</span><span class="mf">1.96</span><span class="o">*</span><span class="n">se</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">p_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;log_wage ~ years_of_schooling + C(state_of_birth) + C(year_of_birth) + C(quarter_of_birth)&quot;</span>
<span class="n">ols</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">parse</span><span class="p">(</span><span class="n">ols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameter: 0.06732572817658422
SE: 0.00038839984390486796
95 CI: [0.06656446 0.06808699]
P-value: 0.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="quarter-of-birth">
<h3>Quarter of birth<a class="headerlink" href="#quarter-of-birth" title="Permalink to this heading">#</a></h3>
<p>Show that quarter of birth is an instrumental variable, which requires it to:</p>
<p>(1) <strong>Cause variation in exposure</strong> - individuals born in the last quarter of the year have slightly more time in education than those born in the beginning of the year</p>
<p>We check this using a graph and regression. For simplicity, we’re just using Q4 (yes/no) as our instrument.</p>
<p>In the regression, we regress the instrumental variable (q4) and confounders (year + state of birth) on the exposure (years of schooling). This will statistically demonstrate that Q4 is an instrumental variable - will show us that quarter of birth affects years of schooling, whilst also control for year and state of birth. Here, on average, Q4 have 0.1 more years of education than those born in other quarters of year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">group_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;year_of_birth&quot;</span><span class="p">,</span> <span class="s2">&quot;quarter_of_birth&quot;</span><span class="p">])</span>
              <span class="p">[[</span><span class="s2">&quot;log_wage&quot;</span><span class="p">,</span> <span class="s2">&quot;years_of_schooling&quot;</span><span class="p">]]</span>
              <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
              <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">time_of_birth</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;year_of_birth&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;quarter_of_birth&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;time_of_birth&quot;</span><span class="p">],</span> <span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;years_of_schooling&quot;</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;quarter_of_birth==</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;time_of_birth&quot;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;quarter_of_birth==</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;years_of_schooling&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Years of Education by Quarter of Birth (first stage)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year of Birth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Years of Schooling&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ead9373117544b97e9fd215d02131225867d35b381326cf17916eab8fe782bd3.png" src="../_images/ead9373117544b97e9fd215d02131225867d35b381326cf17916eab8fe782bd3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run regression</span>
<span class="n">first_stage</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s1">&#39;years_of_schooling ~ C(year_of_birth) + C(state_of_birth) + q4&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Display results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q4 parameter estimate:, &quot;</span><span class="p">,</span> <span class="n">first_stage</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q4 p-value:, &quot;</span><span class="p">,</span> <span class="n">first_stage</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>q4 parameter estimate:,  0.10085809272786678
q4 p-value:,  5.464829416613623e-15
</pre></div>
</div>
</div>
</div>
<p>(2) <strong>Be unrelated to the outcome</strong> (and therefore to unmeasured confounders) - influence should all be due to effect on treatment. Here, we see seasonal pattern in outcome (earnings). We run a regression of the instrumental variable (Q4) and confounders (year + state of bith) on the outcome (wages). We see a significant result. Those born in Q4 have, on average 0.8% higher wages. P-value not as close to 0 as before, but pretty significant.</p>
<p><strong>Note:</strong> It’s not possible to verify this condition - we can only argue in favour of it - i.e. no reason for pattern to affect income beyond through education.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;time_of_birth&quot;</span><span class="p">],</span> <span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;log_wage&quot;</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;quarter_of_birth==</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;time_of_birth&quot;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;quarter_of_birth==</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;log_wage&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Average Weekly Wage by Quarter of Birth (reduced form)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year of Birth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log Weekly Earnings&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/536fed5741748c8ba576d505f08060693ec722a705ec973db5cf39d484a9f079.png" src="../_images/536fed5741748c8ba576d505f08060693ec722a705ec973db5cf39d484a9f079.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_form</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s2">&quot;log_wage ~ C(year_of_birth) + C(state_of_birth) + q4&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q4 parameter estimate:, &quot;</span><span class="p">,</span> <span class="n">reduced_form</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q4 p-value:, &quot;</span><span class="p">,</span> <span class="n">reduced_form</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>q4 parameter estimate:,  0.008603484260139599
q4 p-value:,  0.001494912718366745
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="estimating-the-average-causal-effect">
<h3>Estimating the average causal effect<a class="headerlink" href="#estimating-the-average-causal-effect" title="Permalink to this heading">#</a></h3>
<div class="section" id="option-1-dividing-reduced-form-by-1st-stage">
<h4>Option 1. Dividing reduced form by 1st stage.<a class="headerlink" href="#option-1-dividing-reduced-form-by-1st-stage" title="Permalink to this heading">#</a></h4>
<p>We can use the two regressions above - namely, the first stage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first_stage</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s1">&#39;years_of_schooling ~ C(year_of_birth) + C(state_of_birth) + q4&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>And the reduced form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_form</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s2">&quot;log_wage ~ C(year_of_birth) + C(state_of_birth) + q4&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>To get an unbiased IV estimate of the average causal effect, we can scale the effect of the reduced form coefficient by the first stage coefficient:</p>
<p>$
\mathrm{ATE}_{IV} = \dfrac{\text{Reduced Form}}{\text{1st Stage}}
$</p>
<p>Below, we see 0.08… which means we expect each additional year in school to increase wages by 8%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_form</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">first_stage</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;q4&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.08530286492084817
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="option-2-2-stages-least-squares-2sls">
<h4>Option 2. 2 stages least squares (2SLS)<a class="headerlink" href="#option-2-2-stages-least-squares-2sls" title="Permalink to this heading">#</a></h4>
<p>In 2SLS, we do the first stage as before -</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first_stage</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s1">&#39;years_of_schooling ~ C(year_of_birth) + C(state_of_birth) + q4&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>But then, run second stage where replace treatment variable with fitted values of the first stage. These are essentially “the treatment purged from omitted variable bias”. Fitted values are the predicted values of the outcome variable from the model, when you input the values of the predictors into the model.</p>
<p>We see the same results as with option 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sls_data</span> <span class="o">=</span> <span class="n">factor_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">years_of_schooling_fitted</span><span class="o">=</span><span class="n">first_stage</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>

<span class="n">iv_by_hand</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
    <span class="s2">&quot;log_wage ~ C(year_of_birth) + C(state_of_birth) + years_of_schooling_fitted&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sls_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">iv_by_hand</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;years_of_schooling_fitted&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.08530286492089094
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="option-3-automated-2sls">
<h4>Option 3. Automated 2SLS<a class="headerlink" href="#option-3-automated-2sls" title="Permalink to this heading">#</a></h4>
<p>This is recommended, as else standard errors from second stage are a bit off.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;log_wage ~ 1 + C(year_of_birth) + C(state_of_birth) + [years_of_schooling ~ q4]&#39;</span>
<span class="n">iv2sls</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">parse</span><span class="p">(</span><span class="n">iv2sls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameter: 0.08530286494062492
SE: 0.025540812815019267
95 CI: [0.03524287 0.13536286]
P-value: 0.0008381914642161536
</pre></div>
</div>
</div>
</div>
<p>You can also run with multiple instruments - here, all the quarters of birth…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;log_wage ~ 1 + C(year_of_birth) + C(state_of_birth) + [years_of_schooling ~ q1+q2+q3]&#39;</span>
<span class="n">iv_many_zs</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">factor_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">parse</span><span class="p">(</span><span class="n">iv_many_zs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameter: 0.1076937048813452
SE: 0.01955714901081754
95 CI: [0.06936169 0.14602572]
P-value: 3.657974700921329e-08
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h4>
<p>Comparing traditional OLS with 2SLS:</p>
<ul class="simple">
<li><p>Education estimate lower with OLS than 2SLS, suggesting omitted variable bias may be less strong than thought</p></li>
<li><p>2SLS has much wider confidence intervals than OLS</p></li>
</ul>
<p>Some things to consider:</p>
<ul class="simple">
<li><p>If an instrumental variable has a <strong>small correlation</strong> with the treatment, then it is a weak instrument, and we won’t be able to learn much from the instrument.</p></li>
<li><p>2SLS is biased towards OLS (i.e. if OLS has positive/negative bias, then so will 2SLS)</p></li>
<li><p>Bias will increase with the number of instruments added</p></li>
</ul>
<p>Common mistakes:</p>
<ul class="simple">
<li><p>Doing IV by hand</p></li>
<li><p>Using alternatives to OLS for the first stage. ‘The consistency of IV relies on a property that only OLS can give, which is the orthogonality of the residuals, so anything different than OLS on the 1st stage will yield something biased.’</p></li>
</ul>
</div>
</div>
</div>
</div>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="b3_gestimation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">G-estimation of structural nested models</p>
      </div>
    </a>
    <a class="right-next"
       href="c2_regression_discontinuity.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Regression discontinuity (RD)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-an-instrumental-variable">What is an instrumental variable?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-stage-least-squares-2sls">Two-stage least squares (2SLS)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-of-instrumental-variable-analysis">Assumptions of instrumental variable analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">Limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-instrumental-variable-methods">Non-parametric instrumental variable methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1-mendelian-randomisation">Example 1: Mendelian randomisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-effect-of-intensive-treatment-on-mortality-in-patients-with-acute-myocardial-infarction">Example 2: Effect of intensive treatment on mortality in patients with acute myocardial infarction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3-caesarean-section">Example 3: caesarean section</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-example">Python example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-import-packages-and-data">Set-up (import packages and data)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traditional-ols-estimate">Traditional OLS estimate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quarter-of-birth">Quarter of birth</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-average-causal-effect">Estimating the average causal effect</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-dividing-reduced-form-by-1st-stage">Option 1. Dividing reduced form by 1st stage.</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-2-stages-least-squares-2sls">Option 2. 2 stages least squares (2SLS)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-3-automated-2sls">Option 3. Automated 2SLS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/causal_methods/c1_instrumental_variable.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Amy Heather.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>