<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>22&nbsp; Discrete event simulation (DES) ‚Äì Programming notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/causal_concepts/1_predict_vs_causal.html" rel="next">
<link href="../../content/simulation/simulation.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a34d670291f06f286357e447776a572a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Programming notes</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/amyheather/programming_notes"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/simulation/simulation.html">Simulation</a></li><li class="breadcrumb-item"><a href="../../content/simulation/discrete_event.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Discrete event simulation (DES)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Programming notes</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">General</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linux</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Latex</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Machine learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/open_science.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Open Science</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/zenodo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Zenodo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/general/other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Other</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">General Python Stuff</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Python environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/seeds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Seeds</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/simpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DES using SimPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/books.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Books</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/jupyter_book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Jupyter book</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/python/sphinx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Sphinx</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/r/general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/r/packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/r/environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Dependency management in R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Simulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/simulation/simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/simulation/discrete_event.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Discrete event simulation (DES)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Causal concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/1_predict_vs_causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Prediction v.s. causal inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/2_intro_to_causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">The three ‚Äúlanguages‚Äù of causal inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/3_dags.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Directed acyclic graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/4_assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Assumptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/5_estimands.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Causal estimands</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/6_propensity_scores.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Propensity scores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_concepts/7_target_trial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Target trial emulation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Causal methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/a1_multivariable_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Multivariable regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/a2_stratification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/a3_matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/a4_iptw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Inverse probability of treatment weighting (IPTW) with baseline covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/b1_marginal_structural_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Marginal structural models (MSM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/b2_gcomputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">G-computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/b3_gestimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">G-estimation of structural nested models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/c1_instrumental_variable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Instrumental variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/c2_regression_discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Regression discontinuity (RD)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/c3_interrupted_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Interrupted time series (ITS)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/c4_diff_in_diff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Difference in differences (DiD)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/causal_methods/other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Other methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-des" id="toc-what-is-des" class="nav-link active" data-scroll-target="#what-is-des"><span class="header-section-number">22.1</span> What is DES?</a></li>
  <li><a href="#components-of-a-des" id="toc-components-of-a-des" class="nav-link" data-scroll-target="#components-of-a-des"><span class="header-section-number">22.2</span> Components of a DES</a></li>
  <li><a href="#des-inputs" id="toc-des-inputs" class="nav-link" data-scroll-target="#des-inputs"><span class="header-section-number">22.3</span> DES Inputs</a></li>
  <li><a href="#des-outputs" id="toc-des-outputs" class="nav-link" data-scroll-target="#des-outputs"><span class="header-section-number">22.4</span> DES Outputs</a></li>
  <li><a href="#initialisation-bias" id="toc-initialisation-bias" class="nav-link" data-scroll-target="#initialisation-bias"><span class="header-section-number">22.5</span> Initialisation bias</a>
  <ul class="collapse">
  <li><a href="#method-1.-inspect-time-series" id="toc-method-1.-inspect-time-series" class="nav-link" data-scroll-target="#method-1.-inspect-time-series"><span class="header-section-number">22.5.1</span> Method 1. Inspect time series</a></li>
  <li><a href="#method-2.-set-initial-conditions-manually" id="toc-method-2.-set-initial-conditions-manually" class="nav-link" data-scroll-target="#method-2.-set-initial-conditions-manually"><span class="header-section-number">22.5.2</span> Method 2. Set initial conditions manually</a></li>
  </ul></li>
  <li><a href="#queue-characteristics" id="toc-queue-characteristics" class="nav-link" data-scroll-target="#queue-characteristics"><span class="header-section-number">22.6</span> Queue characteristics</a></li>
  <li><a href="#appointment-booking" id="toc-appointment-booking" class="nav-link" data-scroll-target="#appointment-booking"><span class="header-section-number">22.7</span> Appointment booking</a></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility"><span class="header-section-number">22.8</span> Reproducibility</a></li>
  <li><a href="#evaluating-model-performance" id="toc-evaluating-model-performance" class="nav-link" data-scroll-target="#evaluating-model-performance"><span class="header-section-number">22.9</span> Evaluating model performance</a>
  <ul class="collapse">
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics"><span class="header-section-number">22.9.1</span> Metrics</a></li>
  <li><a href="#scenario-analysis" id="toc-scenario-analysis" class="nav-link" data-scroll-target="#scenario-analysis"><span class="header-section-number">22.9.2</span> Scenario analysis</a></li>
  <li><a href="#replications" id="toc-replications" class="nav-link" data-scroll-target="#replications"><span class="header-section-number">22.9.3</span> Replications</a></li>
  </ul></li>
  <li><a href="#model-verification-and-validation" id="toc-model-verification-and-validation" class="nav-link" data-scroll-target="#model-verification-and-validation"><span class="header-section-number">22.10</span> Model verification and validation</a></li>
  <li><a href="#packages-and-software-for-discrete-event-simulation" id="toc-packages-and-software-for-discrete-event-simulation" class="nav-link" data-scroll-target="#packages-and-software-for-discrete-event-simulation"><span class="header-section-number">22.11</span> Packages and software for discrete event simulation</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">22.12</span> Examples</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/simulation/simulation.html">Simulation</a></li><li class="breadcrumb-item"><a href="../../content/simulation/discrete_event.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Discrete event simulation (DES)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Discrete event simulation (DES)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="what-is-des" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="what-is-des"><span class="header-section-number">22.1</span> What is DES?</h2>
<p>A DES models the behaviour of a system as a sequence of events in time. <a href="https://www.quora.com/What-is-the-difference-between-Monte-Carlo-and-discrete-event-simulation">[source]</a> It is used to model queueing problems (e.g.&nbsp;people waiting for service/s). <a href="https://hsma-programme.github.io/hsma6_des_book/intro_to_des_concepts.html">[source]</a> It is: * <strong>Stochastic (probablistic)</strong> - use random variables as inputs. Also known as probablistic models. Incorporate randomness/information about uncertainty. <a href="https://www.preventionweb.net/understanding-disaster-risk/key-concepts/deterministic-probabilistic-risk">[source]</a> * <strong>Dynamic</strong> - represents changes in system over time * <strong>Discrete</strong> - variables change at discrete points in time (e.g.&nbsp;customer arrivals) <a href="https://bookdown.org/manuele_leonelli/SimBook/types-of-simulations.html">[source]</a></p>
<p>The output of a stochastic model is a <strong>distribution</strong> so stochastic healthcare systems have variable performance. Model is a simplification of the system that attempts to mimic that variation. If we want to compare two or more systems that have stochastic behaviour and output a random variable, then we must do so carefully as there is a risk of making an inference error.[TomL7]</p>
<p>It uses <strong>next event time handling</strong>, meaning it keeps track of when events are due and hopes from event to event. This is more efficient, as ignores time inbetween when nothing is happening.[TomL7]</p>
</section>
<section id="components-of-a-des" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="components-of-a-des"><span class="header-section-number">22.2</span> Components of a DES</h2>
<p>You can have a single <strong>run</strong> of a model, or you can have a batch of runs with the same parameter values which is a <strong>trial</strong>.</p>
<p>You model has <strong>entities</strong> (e.g.&nbsp;patients, ambulances, hospitals). The frequency at which they are generated can be determined by the <strong>inter-arrival time</strong>.</p>
<p>Entities wait in <strong>queues</strong> for <strong>activities</strong>. The queue will have a queueing policy which determines the order that entities are released (commonly first in first out, or priority-based). How long the activity then takes is the <strong>activity time</strong>. We also know the <strong>resources</strong> required for an activity to happen (specifically, the type and number of resources).</p>
<p><strong>Sinks</strong> are how entities leave the model - which happens when they are outside of the model scope.</p>
<p>Entities can have <strong>attributes</strong> that determine their journey (e.g.&nbsp;which path, queue priority, activity length). <a href="https://hsma-programme.github.io/hsma6_des_book/intro_to_des_concepts.html">[source]</a></p>
<p>Diagram created used <a href="https://app.diagrams.net/">https://app.diagrams.net/</a>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/des_components.drawio.png" class="img-fluid figure-img"></p>
<figcaption>DES components diagram</figcaption>
</figure>
</div>
<p>You can have <strong>branching paths</strong> (so different entities flow to different activities and/or sinks), which might be due to attributes, or probability, or time.</p>
<p>You will monitor <strong>outputs</strong> that answer your modelling questions - often this is a description of time that entities are in the system, queue length and duration, resource utilisation, probability of exceeding a threshold. <a href="https://hsma-programme.github.io/hsma6_des_book/intro_to_des_concepts.html">[source]</a></p>
</section>
<section id="des-inputs" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="des-inputs"><span class="header-section-number">22.3</span> DES Inputs</h2>
<p>You use <strong>input modelling</strong> to determine the appropriate inputs for your model. This has four stages: 1. <strong>Data collection.</strong> 2. <strong>Identifying the input data distribution.</strong> (e.g.&nbsp;review data histogram, think about context/intended use of data, consider whether there is correlation/dependency which may mean you need ‚Äòmore complex distributions that can represent autocorrelative processes, time-series data, or multivariate inputs‚Äô, whether the process changes over time, and the range of the data) 3. <strong>Estimating parameters for the selected distribution.</strong> (e.g.&nbsp;normal distribution needs mean and variance/standard deviation, bernoulli distribution needs probability of success/failure in a binary experiment). Commonly use maximum likelihood estimation (MLE) or least-squares estimation 4. <strong>Estimating the goodness of fit.</strong> Estimates ‚Äòcloseness between real data and samples that the selected probability distribution produces‚Äô (e.g.&nbsp;Kolmogorov-Smirnov test) <a href="https://softwaresim.com/blog/input-modeling-as-a-foundation-for-simulation/">[source]</a></p>
</section>
<section id="des-outputs" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="des-outputs"><span class="header-section-number">22.4</span> DES Outputs</h2>
<p>A simulation like DES can be either: * <strong>Terminating</strong> - starts empty and finishes empty (e.g.&nbsp;day surgery) * <strong>Non-terminating</strong> - no natural endpoint (e.g.&nbsp;emergency department) [TomL10]</p>
<p>There are four possible output types from these models: * <strong>Transient</strong> output - distribution of output is constantly changing * <strong>Steady state</strong> - output is consistent - it varies but within a fixed distribution (steady-state distribution) * <strong>Steady-state cycle</strong> - outputs shifts from one steady-state to another in a regular pattern (e.g.&nbsp;call volume differs by time of day, but will be in a steady-state if comparing the same time of day across multiple days) * <strong>Shifting steady-state</strong> - output shifts from one steady-state to another without a regular/predictable pattern</p>
<p><strong>Terminating</strong> models typically have <strong>transient</strong> output. <strong>Non-terminating</strong> models typically have a <strong>steady-state</strong> output (possibly with a cycle or shifts). It is possible however for a terminating model to have a steady state output (particularly if have long run length before terminates), and for a non-terminating model to not reach steady state. <a href="https://books.google.co.uk/books?id=Dtn0oAEACAAJ">[source]</a></p>
</section>
<section id="initialisation-bias" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="initialisation-bias"><span class="header-section-number">22.5</span> Initialisation bias</h2>
<p>Data collection should have a <strong>realistic starting point</strong>. Our problem is that models have <strong>initialisation bias</strong> - i.e.&nbsp;they start in an unrealistic state. To deal with this‚Ä¶</p>
<section id="method-1.-inspect-time-series" class="level3" data-number="22.5.1">
<h3 data-number="22.5.1" class="anchored" data-anchor-id="method-1.-inspect-time-series"><span class="header-section-number">22.5.1</span> Method 1. Inspect time series</h3>
<p>A <strong>warm-up period</strong> is when you run the model like normal, but don‚Äôt collect the results. <a href="https://hsma-programme.github.io/hsma6_des_book/model_warm_up.html">[source]</a></p>
<p>To find the length of the warm-up period, you should run the simulation for a long time, inspect a metric (e.g.&nbsp;waiting time every 60 minutes), and look for when it enters steady state. You would then delete that portion of the simulation (i.e.&nbsp;don‚Äôt save results until past the time threshold).[TomL10]</p>
<p>To identify when you have reached the steady state, you can either: * <strong>Use statistical method</strong> to determine when equilibrium is reached - <a href="https://eudl.eu/pdf/10.4108/ICST.SIMUTOOLS2009.5603">example</a> * Eyeball it * Run it for a long time <a href="https://hsma-programme.github.io/hsma6_des_book/model_warm_up.html">[source]</a></p>
</section>
<section id="method-2.-set-initial-conditions-manually" class="level3" data-number="22.5.2">
<h3 data-number="22.5.2" class="anchored" data-anchor-id="method-2.-set-initial-conditions-manually"><span class="header-section-number">22.5.2</span> Method 2. Set initial conditions manually</h3>
<p>This save run time as you normally run and then delete warmup. This can either be based on: * <strong>Real system</strong> * Running the <strong>model</strong> with warm-up and observing the steady state conditions</p>
<p>You could consider using a <strong>distribution</strong> of initial conditions.</p>
</section>
</section>
<section id="queue-characteristics" class="level2" data-number="22.6">
<h2 data-number="22.6" class="anchored" data-anchor-id="queue-characteristics"><span class="header-section-number">22.6</span> Queue characteristics</h2>
<p>‚ÄòThe <strong>queue discipline</strong> indicates the order in which members of the queue are selected for service‚Äô.<a href="https://www.oreilly.com/library/view/quantitative-techniques-theory/9789332512085/xhtml/ch9sec9.xhtml">[source]</a></p>
<p>Discplines: * <strong>FIFO (first-in first-out)</strong> - a.k.a. FCFS (first-come first served) * <strong>LIFO (last-in first-out)</strong> - last entity is served first (e.g.&nbsp;eating a stack of pancakes)<a href="https://people.revoledu.com/kardi/tutorial/Queuing/Queuing-Discipline.html">[source]</a> * <strong>SIRO (service in random order)</strong> - i.e.&nbsp;randomly * <strong>Priority queue</strong> when certain entities get priority <a href="https://www.oreilly.com/library/view/quantitative-techniques-theory/9789332512085/xhtml/ch9sec9.xhtml">[source]</a></p>
<p>There are then certain behaviours we might observe‚Ä¶</p>
<p><strong>Reneging</strong> - Entity removes themself from a queue after a certain amount of time has elapsed * E.g. Patient attribute of patience (e.g.&nbsp;sample a number, and thats how many minutes they are prepared to wait), when request resource tell simpy to wait until request is met or the patients patience expires. If they reneged, they won‚Äôt see nurse and we record the number that reneged</p>
<p><strong>Balking</strong> - Entity chooses not to enter a queue in the first place because (a) it is too long for their preferences, or (b) there is no capacity for them * Example for (b): Have parameter in g class with maximum queue length allowed. Have model attribute storing patients in queue, updated whenever patient leaves or joins. Before ask for nurse resource, check if queue is at max size. If so, patient will never join queue and we record that.</p>
<p><strong>Jockeying</strong> - Entity switches queues in the hope of reducing queue time * Never used in healthcare system. However, you might have system where entities pick which queue to join in the first place based on queue length (e.g.&nbsp;choosing between MIU or ED based on live waiting time data online) <a href="https://hsma-programme.github.io/hsma6_des_book/reneging_balking_jockeying.html">[source]</a></p>
</section>
<section id="appointment-booking" class="level2" data-number="22.7">
<h2 data-number="22.7" class="anchored" data-anchor-id="appointment-booking"><span class="header-section-number">22.7</span> Appointment booking</h2>
<p>Above, we‚Äôve assumed that arrivals flow through the system immediately (or as quickly as possible, depending on queues). That‚Äôs good for services like ED, walk-in clinic.</p>
<p>For services where clients are booked in future, there is <strong>delay between making appointment and attending</strong>. Possibile complexities include - * Setting aside slots for <strong>urgent referrals</strong> and balancing that against capacity * Patients with <strong>regular appointments</strong> at certain intervals * <strong>Triage</strong> step before appointment where decide whether need one or not * <strong>Non-attendance of the appointment</strong> meaning either exit system or need to rebook <a href="https://hsma-programme.github.io/hsma6_des_book/appointment_style_booking_models.html">[source]</a></p>
</section>
<section id="reproducibility" class="level2" data-number="22.8">
<h2 data-number="22.8" class="anchored" data-anchor-id="reproducibility"><span class="header-section-number">22.8</span> Reproducibility</h2>
<p>You could set one seed per run. We then do 100 runs. Then we repeat that again. We want the results to be the same - and they are, yay!</p>
<p>Now we do a scenario where we <strong>change the number of nurses</strong>. We expect this to: * <strong>Change the queues</strong> for nurses and doctors - yes üôÇ * Number of <strong>arrivals remain unchanged</strong> - <strong>no</strong>! üôÅ</p>
<p>This is because all the methods are using one seed. The order that the random numbers are generated in matters. As the order of events changes (e.g.&nbsp;as have more nurses, they can see more patients quicker, changing the order that subsequent events happen).</p>
<p>Hence, a robust way to do this is to <strong>set seeds for each type of event that we are generating random numbers for</strong>. This means that each event has a separate random number stream for each part of process (e.g.&nbsp;for the inter-arrival times, for the consult times, for our probabilities when branching). <a href="https://hsma-programme.github.io/hsma6_des_book/reproducibility.html">[source]</a></p>
</section>
<section id="evaluating-model-performance" class="level2" data-number="22.9">
<h2 data-number="22.9" class="anchored" data-anchor-id="evaluating-model-performance"><span class="header-section-number">22.9</span> Evaluating model performance</h2>
<section id="metrics" class="level3" data-number="22.9.1">
<h3 data-number="22.9.1" class="anchored" data-anchor-id="metrics"><span class="header-section-number">22.9.1</span> Metrics</h3>
<p><strong>Arrivals</strong>. (e.g.&nbsp;total arrivals per day)</p>
<p><strong>Resource utilisation</strong>. We want to track resource utilisation <strong>overall</strong> as well as at <strong>specific time points</strong>. We often won‚Äôt want utilisation to be close to 100%, although what we do want depends on the type and size of service (e.g.&nbsp;emergency service want lower utilisation so can safely cope with spike in demand). <a href="https://hsma-programme.github.io/hsma6_des_book/tracking_resource_utilisation.html">[source]</a></p>
<p><strong>Percentage of entities meeting a target</strong> (e.g.&nbsp;4 hour arrival to admission). Consider whether anything in historical data patterns is because of trying to meet targets (e.g.&nbsp;17% of admissions to a&amp;e between 3h50 and 4h). ‚ÄúIf the target was removed, would this result in a change in behaviour? How might the predictions of our model be affected by this?‚Äù</p>
<p><strong>Throughput - % of people entering system who have left by time model stops running</strong> - low throughput suggests a bottleneck - ‚Äúcan be a useful measure to track as a quick way of assessing whether different scenarios are leading to severe bottlenecks, but it is not that useful as a standalone measure.‚Äù <a href="https://hsma-programme.github.io/hsma6_des_book/other_model_metrics.html">[source]</a></p>
</section>
<section id="scenario-analysis" class="level3" data-number="22.9.2">
<h3 data-number="22.9.2" class="anchored" data-anchor-id="scenario-analysis"><span class="header-section-number">22.9.2</span> Scenario analysis</h3>
<p><strong>Scenario analysis</strong> involves compare the results from multiple different scenarios (e.g.&nbsp;different levels of resource, arrivals, etc).</p>
<p>Reproducibility: When doing this, use <strong>different random seeds</strong> for each replication or move fixed LARGE number of steps down random number stream on each replication. However, you might use the same pseudo random numbers in two scenarios, else you see change from scenario and random numbers (which means more noise and needs more replications), whereas consistency means less needed. When doing this, we create a correlation between the two scenarios.[TomL7]</p>
<p>You may have limited number of pre-defined scenarios to compare (<strong>comparing alternatives</strong>), or have no pre-defined scenarios and instead be varying experiemental factors until you reach a target or output metric level (<strong>search experimentation</strong>).<a href="https://books.google.co.uk/books?id=Dtn0oAEACAAJ">[source]</a></p>
</section>
<section id="replications" class="level3" data-number="22.9.3">
<h3 data-number="22.9.3" class="anchored" data-anchor-id="replications"><span class="header-section-number">22.9.3</span> Replications</h3>
<p>Have <strong>replications</strong> (multiple runs) when estimating the performance of a given scenario.</p>
<p>To decide how many do to, find the point where the confidence interval is consistently 10% deviation from the mean (worth checking by adding a few more replications, and also, you might never reach that point).[TomL10]</p>
<p>Image from Tom Lecture 10:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/choose_n_scenario.png" class="img-fluid figure-img"></p>
<figcaption>Choosing number of scenarios</figcaption>
</figure>
</div>
</section>
</section>
<section id="model-verification-and-validation" class="level2" data-number="22.10">
<h2 data-number="22.10" class="anchored" data-anchor-id="model-verification-and-validation"><span class="header-section-number">22.10</span> Model verification and validation</h2>
<p><strong>Verification</strong> = ensure model design has been transformed into computer model with sufficient accuracy</p>
<p><strong>Validation</strong> = ensure model is sufficiently accurate for purpose * <strong>Conceptual model validation</strong> - whether content, assumptions and simplifications are sufficiently accurate (i.e.&nbsp;does model have necessary details to meet study objective) * <strong>Data validation</strong> - whether data used at any stage are sufficiently accurate * <strong>White-box validation</strong> - careful check of each part of model and whether it represents real world with sufficient accuracy * <strong>Black-box validation</strong> - thinking overall whether model represents real world with sufficient accuracy * <strong>Experimentation validation</strong> - ensuring procedures allow accurate results i.e.&nbsp;requirements for removing initialisation bias, run length, replications, sensitivity analysis, and searching of solution space to ensure that learning is maximised and appropriate solutions identified * <strong>Solution validation</strong> - compared the simulation model to the implemented solution (i.e.&nbsp;after modelling done and made changes in real life) <a href="https://books.google.co.uk/books?id=Dtn0oAEACAAJ">[source]</a></p>
</section>
<section id="packages-and-software-for-discrete-event-simulation" class="level2" data-number="22.11">
<h2 data-number="22.11" class="anchored" data-anchor-id="packages-and-software-for-discrete-event-simulation"><span class="header-section-number">22.11</span> Packages and software for discrete event simulation</h2>
<p>Python packages: * <strong>SimPy</strong> * <strong>CIW</strong> - <a href="https://ciw.readthedocs.io/en/latest/">docs</a>, <a href="https://github.com/TomMonks/ciw-urgent-care-call-centre">example</a>, <a href="https://health-data-science-or.github.io/simpy-streamlit-tutorial/content/03_streamlit/13_ciw_backend.html">conversion from SimPy</a> * <strong>Salabim</strong> - <a href="https://www.salabim.org/manual/Overview.html">docs</a>, provides methods for 2D and 3D animation</p>
<p>R packages: * <strong>simmerR</strong> - <a href="https://r-simmer.org/">docs</a>, <a href="https://r-simmer.org/articles/simmer-05-simpy">conversion from SimPy</a>, <a href="https://the-strategy-unit.github.io/des_simmer_workshop/">tutorial</a>, can plot flow diagram of steps in model</p>
<p>FOSS GUI software (i.e.&nbsp;drag and drop): * <strong>JaamSim</strong> <a href="https://hsma-programme.github.io/hsma6_des_book/alternative_foss_simulation_libraries_software.html">[source]</a></p>
<p>Non-FOSS GUI: * Simul8</p>
</section>
<section id="examples" class="level2" data-number="22.12">
<h2 data-number="22.12" class="anchored" data-anchor-id="examples"><span class="header-section-number">22.12</span> Examples</h2>
<ul>
<li><a href="https://hsma-programme.github.io/Teaching_DES_Concepts_Streamlit/">Streamlit app with key DES concepts</a></li>
<li><a href="https://github.com/stars/Bergam0t/lists/simpy-examples">SimPy examples</a></li>
<li><a href="https://github.com/Bergam0t/simpy_visualisation">Visualisation examples</a> <a href="https://hsma-programme.github.io/hsma6_des_book/further_reading.html">[source]</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/simulation/simulation.html" class="pagination-link" aria-label="Simulation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Simulation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/causal_concepts/1_predict_vs_causal.html" class="pagination-link" aria-label="Prediction v.s. causal inference">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Prediction v.s. causal inference</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>